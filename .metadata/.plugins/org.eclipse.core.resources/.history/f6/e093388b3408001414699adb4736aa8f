package com.controlador;
import java.io.IOException;

import javax.servlet.http.*;

import com.modelo.DataStoreConection;


@SuppressWarnings("serial")
public class CSNnewsServlet extends HttpServlet {
	/* Este servlet validará los correos de las cuentas de usuario registradas
	 * al cual accederan por un enlace que se envia a los correos 
	 * en el cual estan predefinidas las variables por GET: correo, user, cod y validate
	 * http://dominio.com/csnews?user=...&correo=...&cod=...&validate=true 
	 * */
	
	public void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
		/*Recibe las variables de validación por GET*/
		//String username = req.getParameter("user");
		//String validate = req.getParameter("validate");		
		String correo = req.getParameter("correo");
		String codigo_validacion = req.getParameter("cod");		
			
		DataStoreConection ds = new DataStoreConection();
		/* Se edita el datastore con su función validar_cuenta(correo, codigo_validacion),
		 *  cambiando el valor predefinido del atributo validado en la entidad 
		 *  usuario de 0 a 1 y retornando true si se hizo satisfactoriamente y false caso contrario 
		 * */
		if(ds.validar_cuenta(correo, codigo_validacion)){
			/*Se redirecciona a notificaciones indicando por GET: m=cuenta_validada
			 * para que se muestre el mensaje de validación correspondiente*/
			resp.sendRedirect("notificaciones.jsp?m=cuenta_validada ");
		}else{
			/*Se redirecciona a notificaciones indicando por GET: m=datos_erroneos
			 * para que se muestre el mensaje correspondiente de datos no procesados
			 * por haber sido alterados o inexistentes*/
			resp.sendRedirect("notificaciones.jsp?m=datos_erroneos;correo="+correo+";codigo="+codigo_validacion);
		}		
	}
}
